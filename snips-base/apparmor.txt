#include <tunables/global>
@{DOCKER_OVERLAY} = /var/lib/docker/overlay2/*/diff
@{DOCKER_OVERLAY2} = /docker/overlay2/*/diff

profile local_snips-base flags=(attach_disconnected,mediate_deleted) {
	#include <abstractions/base>
	#include <abstractions/bash>
	#include <abstractions/nameservice>
	#include <abstractions/openssl>
	#include <abstractions/ssl_certs>

	capability net_bind_service,
	capability setgid,
	capability setuid,
	capability dac_override,

	/data/**							r,
	/data/mosquitto.db						lw,
	/data/mosquitto.db.new						lw,
	/share/**							r,

	/etc/								r,
	@{DOCKER_OVERLAY}/etc/						r,
	@{DOCKER_OVERLAY2}/etc/						r,
	/etc/**								r,
	@{DOCKER_OVERLAY}/etc/**					r,
	@{DOCKER_OVERLAY2}/etc/**					r,
	/proc/**							r,
	@{DOCKER_OVERLAY}/proc/**					r,
	@{DOCKER_OVERLAY2}/proc/**					r,
	/ssl/**								r,
	@{DOCKER_OVERLAY}/ssl/**					r,
	@{DOCKER_OVERLAY2}/ssl/**					r,

	/usr/lib/locale/*/LC_MESSAGES**					mr,
	@{DOCKER_OVERLAY}/usr/lib/locale/*/LC_MESSAGES**		mr,
	@{DOCKER_OVERLAY2}/usr/lib/locale/*/LC_MESSAGES**		mr,
	/dev/tty							rw,
	@{DOCKER_OVERLAY}/dev/tty					rw,
	@{DOCKER_OVERLAY2}/dev/tty					rw,

	/etc/snips.toml							rw,
	@{DOCKER_OVERLAY}/etc/snips.toml				rw,
	@{DOCKER_OVERLAY2}/etc/snips.toml				rw,
	/etc/mosquitto/mosquitto.conf					rw,
	@{DOCKER_OVERLAY}/etc/mosquitto/mosquitto.conf			rw,
	@{DOCKER_OVERLAY2}/etc/mosquitto/mosquitto.conf			rw,
	/etc/supervisor/**						mklrw,
	@{DOCKER_OVERLAY}/etc/supervisor/**				mklrw,
	@{DOCKER_OVERLAY2}/etc/supervisor/**				mklrw,
	/supervisord.pid						rw,
	@{DOCKER_OVERLAY}/supervisord.pid				rw,
	@{DOCKER_OVERLAY2}/supervisord.pid				rw,

	/tmp/**								mlkrw,
	@{DOCKER_OVERLAY}/tmp/**					mlkrw,
	@{DOCKER_OVERLAY2}/tmp/**					mlkrw,
	/tmp/								mr,
	@{DOCKER_OVERLAY}/tmp/						mr,
	@{DOCKER_OVERLAY2}/tmp/						mr,
	/usr/include/**							mr,
	@{DOCKER_OVERLAY}/usr/include/**				mr,
	@{DOCKER_OVERLAY2}/usr/include/**				mr,
	/usr/share/pkgconfig/						mr,
	@{DOCKER_OVERLAY}/usr/share/pkgconfig/				mr,
	@{DOCKER_OVERLAY2}/usr/share/pkgconfig/				mr,
	/usr/share/pkgconfig/**						mr,
	@{DOCKER_OVERLAY}/usr/share/pkgconfig/**			mr,
	@{DOCKER_OVERLAY2}/usr/share/pkgconfig/**			mr,
	/usr/local/lib/pkgconfig/					mr,
	@{DOCKER_OVERLAY}/usr/local/lib/pkgconfig/			mr,
	@{DOCKER_OVERLAY2}/usr/local/lib/pkgconfig/			mr,
	/usr/local/lib/pkgconfig/**					mr,
	@{DOCKER_OVERLAY}/usr/local/lib/pkgconfig/**			mr,
	@{DOCKER_OVERLAY2}/usr/local/lib/pkgconfig/**			mr,
	/usr/share/git-core/**						mlkr,
	@{DOCKER_OVERLAY}/usr/share/git-core/**				mlkr,
	@{DOCKER_OVERLAY2}/usr/share/git-core/**			mlkr,
	/usr/share/snips/**						mlkrw,
	@{DOCKER_OVERLAY}/usr/share/snips/**				mlkrw,
	@{DOCKER_OVERLAY2}/usr/share/snips/**				mlkrw,
	/var/lib/snips/**						mlkrw,
	@{DOCKER_OVERLAY}/var/lib/snips/**				mlkrw,
	@{DOCKER_OVERLAY2}/var/lib/snips/**				mlkrw,
	/run/								mr,
	@{DOCKER_OVERLAY}/run/						mr,
	@{DOCKER_OVERLAY2}/run/						mr,
	/run/supervisor.sock*						mlkrw,
	@{DOCKER_OVERLAY}/run/supervisor.sock*				mlkrw,
	@{DOCKER_OVERLAY2}/run/supervisor.sock*				mlkrw,
	/var/run/							mr,
	@{DOCKER_OVERLAY}/var/run/					mr,
	@{DOCKER_OVERLAY2}/var/run/					mr,
	/var/run/supervisor.sock*					mlkrw,
	@{DOCKER_OVERLAY}/var/run/supervisor.sock*			mlkrw,
	@{DOCKER_OVERLAY2}/var/run/supervisor.sock*			mlkrw,
	/share/								mlkrw,
	@{DOCKER_OVERLAY}/share/					mlkrw,
	@{DOCKER_OVERLAY2}/share/					mlkrw,
	/share/snips/							mlkrw,
	@{DOCKER_OVERLAY}/share/snips/					mlkrw,
	@{DOCKER_OVERLAY2}/share/snips/					mlkrw,
	/share/snips/**							lkrw,
	@{DOCKER_OVERLAY}/share/snips/**				mlkrw,
	@{DOCKER_OVERLAY2}/share/snips/**				mlkrw,
	/funcs.sh							r,
	@{DOCKER_OVERLAY}/funcs.sh					r,
	@{DOCKER_OVERLAY2}/funcs.sh					r,

	/root/								mkr,
	@{DOCKER_OVERLAY}/root/						mkr,
	@{DOCKER_OVERLAY2}/root/					mkr,
	/root/.cache/							mlkrw,
	@{DOCKER_OVERLAY}/root/.cache/					mlkrw,
	@{DOCKER_OVERLAY2}/root/.cache/					mlkrw,
	/root/.cache/**							mlkrw,
	@{DOCKER_OVERLAY}/root/.cache/**				mlkrw,
	@{DOCKER_OVERLAY2}/root/.cache/**				mlkrw,

	/sbin/ldconfig							rix,
	@{DOCKER_OVERLAY}/sbin/ldconfig					rix,
	@{DOCKER_OVERLAY2}/sbin/ldconfig					rix,
	/sbin/ldconfig.real						rix,
	@{DOCKER_OVERLAY}/sbin/ldconfig.real				rix,
	@{DOCKER_OVERLAY2}/sbin/ldconfig.real				rix,
	/usr/lib/gcc/x86_64-linux-gnu/*/*				rix,
	@{DOCKER_OVERLAY}/usr/lib/gcc/x86_64-linux-gnu/*/*		rix,
	@{DOCKER_OVERLAY2}/usr/lib/gcc/x86_64-linux-gnu/*/*		rix,
	/extract_assistant.sh						rix,
	@{DOCKER_OVERLAY}/extract_assistant.sh				rix,
	@{DOCKER_OVERLAY2}/extract_assistant.sh				rix,
	/ingress/							r,
	@{DOCKER_OVERLAY}/ingress/					r,
	@{DOCKER_OVERLAY2}/ingress/					r,
	/ingress/__pycache__						mlkrw,
	@{DOCKER_OVERLAY}/ingress/__pycache__				mlkrw,
	@{DOCKER_OVERLAY2}/ingress/__pycache__				mlkrw,
	/ingress/__pycache__/						mlkrw,
	@{DOCKER_OVERLAY}/ingress/__pycache__/				mlkrw,
	@{DOCKER_OVERLAY2}/ingress/__pycache__/				mlkrw,
	/ingress/__pycache__/**						mlkrw,
	@{DOCKER_OVERLAY}/ingress/__pycache__/**			mlkrw,
	@{DOCKER_OVERLAY2}/ingress/__pycache__/**			mlkrw,
	/ingress/control.py						mr,
	@{DOCKER_OVERLAY}/ingress/control.py				mr,
	@{DOCKER_OVERLAY2}/ingress/control.py				mr,
	/ingress/snipsConsole.py					mr,
	@{DOCKER_OVERLAY}/ingress/snipsConsole.py			mr,
	@{DOCKER_OVERLAY2}/ingress/snipsConsole.py			mr,
	/ingress/templates/						r,
	@{DOCKER_OVERLAY}/ingress/templates/				r,
	@{DOCKER_OVERLAY2}/ingress/templates/				r,
	/ingress/templates/index.html					mr,
	@{DOCKER_OVERLAY}/ingress/templates/index.html			mr,
	@{DOCKER_OVERLAY2}/ingress/templates/index.html			mr,
	/ingress/static/						r,
	@{DOCKER_OVERLAY}/ingress/static/				r,
	@{DOCKER_OVERLAY2}/ingress/static/				r,
	/ingress/static/**						mr,
	@{DOCKER_OVERLAY}/ingress/static/**				mr,
	@{DOCKER_OVERLAY2}/ingress/static/**				mr,
	/manage_tts_cache.sh						rcx,
	/restart_snips_skill_server.sh					rix,
	@{DOCKER_OVERLAY}/restart_snips_skill_server.sh			rix,
	@{DOCKER_OVERLAY2}/restart_snips_skill_server.sh		rix,
	/run.sh								rix,
	@{DOCKER_OVERLAY}/run.sh					rix,
	@{DOCKER_OVERLAY2}/run.sh					rix,
	/setup.sh							rix,
	@{DOCKER_OVERLAY}/setup.sh					rix,
	@{DOCKER_OVERLAY2}/setup.sh					rix,
	/start_service.sh						rix,
	@{DOCKER_OVERLAY}/start_service.sh				rix,
	@{DOCKER_OVERLAY2}/start_service.sh				rix,
	/start_snips_watch.sh						rix,
	@{DOCKER_OVERLAY}/start_snips_watch.sh				rix,
	@{DOCKER_OVERLAY2}/start_snips_watch.sh				rix,
	/stop_snips_watch.sh						rix,
	@{DOCKER_OVERLAY}/stop_snips_watch.sh				rix,
	@{DOCKER_OVERLAY2}/stop_snips_watch.sh				rix,
	/data/tts/							mlkrw,
	@{DOCKER_OVERLAY}/data/tts/					mlkrw,
	@{DOCKER_OVERLAY2}/data/tts/					mlkrw,
	/data/tts/cache/						mlkrw,
	@{DOCKER_OVERLAY}/data/tts/cache/				mlkrw,
	@{DOCKER_OVERLAY2}/data/tts/cache/				mlkrw,
	/data/tts/cache/**						mlkrw,
	@{DOCKER_OVERLAY}/data/tts/cache/**				mlkrw,
	@{DOCKER_OVERLAY2}/data/tts/cache/**				mlkrw,
	/tts/tts.sh							mlkrwcx,
	@{DOCKER_OVERLAY}/tts/tts.sh					mlkrwcx,
	@{DOCKER_OVERLAY2}/tts/tts.sh					mlkrwcx,
	/tts/tts-unparsed.sh						mr,
	@{DOCKER_OVERLAY}/tts/tts-unparsed.sh				mr,
	@{DOCKER_OVERLAY2}/tts/tts-unparsed.sh				mr,
	/update_ha_config.py						mrcx,
	@{DOCKER_OVERLAY}/update_ha_config.py				mrcx,
	@{DOCKER_OVERLAY2}/update_ha_config.py				mrcx,
	/wait-for-it.sh							rix,
	@{DOCKER_OVERLAY}/wait-for-it.sh				rix,
	@{DOCKER_OVERLAY2}/wait-for-it.sh				rix,
	/bin/*								rcix,
	@{DOCKER_OVERLAY}/bin/*						rcix,
	@{DOCKER_OVERLAY2}/bin/*					rcix,
	/usr/bin/							r,
	@{DOCKER_OVERLAY}/usr/bin/					r,
	@{DOCKER_OVERLAY2}/usr/bin/					r,
	/usr/bin/*							rix,
	@{DOCKER_OVERLAY}/usr/bin/*					rix,
	@{DOCKER_OVERLAY2}/usr/bin/*					rix,
	/usr/local/bin/*						rix,
	@{DOCKER_OVERLAY}/usr/local/bin/*				rix,
	@{DOCKER_OVERLAY2}/usr/local/bin/*				rix,
	/usr/lib/bashio/*						rix,
	@{DOCKER_OVERLAY}/usr/lib/bashio/*				rix,
	@{DOCKER_OVERLAY2}/usr/lib/bashio/*				rix,
	/usr/lib/git-core/*						rix,
	@{DOCKER_OVERLAY}/usr/lib/git-core/*				rix,
	@{DOCKER_OVERLAY2}/usr/lib/git-core/*				rix,
	/usr/sbin/mosquitto						mrcx,
	@{DOCKER_OVERLAY}/usr/sbin/mosquitto				mrcx,
	@{DOCKER_OVERLAY2}/usr/sbin/mosquitto				mrcx,

	/var/lib/snips/skills/**					mlkrwix,
	@{DOCKER_OVERLAY}/var/lib/snips/skills/**			mlkrwix,
	@{DOCKER_OVERLAY2}/var/lib/snips/skills/**			mlkrwix,

	/aws/								mlkrw,
	/aws/**								mlkrwix,

	# Rules for running python scripts
	/usr/lib{,32,64}/python{2.7,3.[0-7]}/				mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python{2.7,3.[0-7]}/		mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python{2.7,3.[0-7]}/		mr,
	/usr/lib{,32,64}/python{2.7,3.[0-7]}/**				mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python{2.7,3.[0-7]}/**	mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python{2.7,3.[0-7]}/**	mr,
	/usr/lib{,32,64}/python{2.7,3.[0-7]}/**/			mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python{2.7,3.[0-7]}/**/	mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python{2.7,3.[0-7]}/**/	mr,
	/usr/lib{,32,64}/python3/					mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3/			mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3/			mr,
	/usr/lib{,32,64}/python3/**					mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3/**			mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3/**			mr,
	/usr/lib{,32,64}/python3/**/					mr,
	@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3/**/			mr,
	@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3/**/			mr,

	/usr/local/lib{,32,64}/python3{,.[0-7]}/			mr,
	@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/	mr,
	@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/	mr,
	/usr/local/lib{,32,64}/python3{,.[0-7]}/**/			mr,
	@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/**/	mr,
	@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/**/	mr,
	/usr/local/lib{,32,64}/python3{,.[0-7]}/**			mr,
	@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/**	mr,
	@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/**	mr,
	/usr/local/lib{,32,64}/python2.7/**/				mr,
	@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python2.7/**		mr,
	@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python2.7/**		mr,

	/etc/python{2.7,3.[0-7]}/**					r,
	@{DOCKER_OVERLAY}/etc/python{2.7,3.[0-7]}/**			r,
	@{DOCKER_OVERLAY2}/etc/python{2.7,3.[0-7]}/**			r,

	/usr/share/{pyshared,pycentral,python-support}/**		r,
	@{DOCKER_OVERLAY}/usr/share/{pyshared,pycentral,python-support}/**	r,
	@{DOCKER_OVERLAY2}/usr/share/{pyshared,pycentral,python-support}/**	r,
	/{var,usr}/lib/{pyshared,pycentral,python-support}/**		r,
	@{DOCKER_OVERLAY}/{var,usr}/lib/{pyshared,pycentral,python-support}/**	r,
	@{DOCKER_OVERLAY2}/{var,usr}/lib/{pyshared,pycentral,python-support}/**	r,
	/usr/lib/{pyshared,pycentral,python-support}/**.so		mr,
	@{DOCKER_OVERLAY}/usr/lib/{pyshared,pycentral,python-support}/**.so	mr,
	@{DOCKER_OVERLAY2}/usr/lib/{pyshared,pycentral,python-support}/**.so	mr,
	/var/lib/{pyshared,pycentral,python-support}/**.pyc		mr,
	@{DOCKER_OVERLAY}/var/lib/{pyshared,pycentral,python-support}/**.pyc	mr,
	@{DOCKER_OVERLAY2}/var/lib/{pyshared,pycentral,python-support}/**.pyc	mr,

	/usr/lib/wx/python/*.pth					r,
	@{DOCKER_OVERLAY}/usr/lib/wx/python/*.pth			r,
	@{DOCKER_OVERLAY2}/usr/lib/wx/python/*.pth			r,

	# Rules for installing pip packages
	/usr/include/python{2.7,3.[0-7]}*/pyconfig.h			r,
	@{DOCKER_OVERLAY}/usr/include/python{2.7,3.[0-7]}*/pyconfig.h	r,
	@{DOCKER_OVERLAY2}/usr/include/python{2.7,3.[0-7]}*/pyconfig.h	r,

	/usr/share/python-wheels/					r,
	@{DOCKER_OVERLAY}/usr/share/python-wheels/			r,
	@{DOCKER_OVERLAY2}/usr/share/python-wheels/			r,
	/usr/share/python-wheels/**					r,
	@{DOCKER_OVERLAY}/usr/share/python-wheels/**			r,
	@{DOCKER_OVERLAY2}/usr/share/python-wheels/**			r,

	/usr/local/lib{,32,64}/python{2.7,3.[0-7]}/{dist,site}-packages/**	mrw,
	@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python{2.7,3.[0-7]}/{dist,site}-packages/**	mrw,
	@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python{2.7,3.[0-7]}/{dist,site}-packages/**	mrw,

	/usr/lib/{,x86_64-linux-gnu/}pkgconfig/				mr,
	@{DOCKER_OVERLAY}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/	mr,
	@{DOCKER_OVERLAY2}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/	mr,
	/usr/lib/{,x86_64-linux-gnu/}pkgconfig/**			mr,
	@{DOCKER_OVERLAY}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/**	mr,
	@{DOCKER_OVERLAY2}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/**	mr,

	# Support TCP Wrappers
	/lib{,32,64}/libwrap.so*				mr,
	/etc/hosts.allow					r,
	/etc/hosts.deny						r,

	profile /tts/tts.sh flags=(attach_disconnected,mediate_deleted) {
		#include <abstractions/base>
		#include <abstractions/bash>
		#include <abstractions/nameservice>
		#include <abstractions/openssl>
		#include <abstractions/ssl_certs>

		capability net_bind_service,
		capability setgid,
		capability setuid,
		capability dac_override,

		/bin/bash						rix,
		/bin/cat						rix,
		/bin/date						rix,
		/bin/ls							rix,
		/bin/readlink						rix,
		/bin/rm							rix,
		/bin/sed						rix,
		/usr/bin/awk						rix,
		/usr/bin/base64						rix,
		/usr/bin/bashio						rix,
		/usr/bin/curl						rix,
		/usr/bin/cut						rix,
		/usr/bin/dirname					rix,
		/usr/bin/env						rix,
		/usr/bin/ffmpeg						rix,
		/usr/bin/md5sum						rix,
		/usr/bin/pico2wave					rix,
		/usr/bin/ssh						rix,
		/usr/bin/wc						rix,
		/usr/lib/bashio/*					rix,
		/usr/local/bin/mimic					rix,
		@{DOCKER_OVERLAY}/usr/lib/bashio/*			rix,
		@{DOCKER_OVERLAY2}/usr/lib/bashio/*			rix,
		/usr/local/share/mimic/voices/				r,
		/usr/local/share/mimic/voices/**			r,
		@{DOCKER_OVERLAY}/usr/local/share/mimic/voices/**	r,
		@{DOCKER_OVERLAY2}/usr/local/share/mimic/voices/**	r,
		/tts/tts.sh						mr,
		/config/**						mr,
		/data/tts/cache/					mlkrw,
		@{DOCKER_OVERLAY}/data/tts/cache/			mlkrw,
		@{DOCKER_OVERLAY2}/data/tts/cache/			mlkrw,
		/data/tts/cache/*					mlkrw,
		@{DOCKER_OVERLAY}/data/tts/cache/*			mlkrw,
		@{DOCKER_OVERLAY2}/data/tts/cache/*			mlkrw,
		/dev/tty						rw,
		/proc/**						mr,
		/share/**						r,
		/sys/devices/**						mr,
		/tmp/**							mlkrw,
		@{DOCKER_OVERLAY}/tmp/**				mlkrw,
		@{DOCKER_OVERLAY2}/tmp/**				mlkrw,
	}

	profile /manage_tts_cache.sh flags=(attach_disconnected,mediate_deleted) {
		#include <abstractions/base>
		#include <abstractions/bash>

		/usr/bin/env						rix,
		/usr/bin/du						rix,
		/bin/ls							rix,
		/bin/rm							rix,
		/bin/bash						rix,
		/bin/readlink						rix,
		/usr/bin/bashio						rix,
		/usr/bin/dirname					rix,
		/usr/bin/head						rix,
		/usr/bin/jq						rix,
		/usr/lib/bashio/*					rix,
		/dev/tty						rw,
		/etc/nsswitch.conf					r,
		/etc/passwd						r,
		@{DOCKER_OVERLAY}/usr/lib/bashio/*			rix,
		@{DOCKER_OVERLAY2}/usr/lib/bashio/*			rix,
		/manage_tts_cache.sh					mr,
		/data/options.json					mr,
		/data/tts/cache/					mlkrw,
		@{DOCKER_OVERLAY}/data/tts/cache/			mlkrw,
		@{DOCKER_OVERLAY2}/data/tts/cache/			mlkrw,
		/data/tts/cache/*					mlkrw,
		@{DOCKER_OVERLAY}/data/tts/cache/*			mlkrw,
		@{DOCKER_OVERLAY2}/data/tts/cache/*			mlkrw,
		/tmp/**							mlkrw,
		@{DOCKER_OVERLAY}/tmp/**				mlkrw,
		@{DOCKER_OVERLAY2}/tmp/**				mlkrw,
	}

	profile /update_ha_config.py flags=(attach_disconnected,mediate_deleted) {
		#include <abstractions/base>

		/usr/bin/env					rix,
		/update_ha_config.py				mr,

		# Need full permissions to /config, because we don't know
		# how/if the user already configured intent_scripts.
		/config/**					rw,

		# Need read-only on /var/lib/snips/skills/**
		/var/lib/snips/skills/**			r,
		@{DOCKER_OVERLAY}/var/lib/snips/skills/**			r,
		@{DOCKER_OVERLAY2}/var/lib/snips/skills/**	r,

		# Need read-only on /usr/share/snips/assistant/**
		/usr/share/snips/assistant/**			r,
		@{DOCKER_OVERLAY}/usr/share/snips/assistant/**	r,
		@{DOCKER_OVERLAY2}/usr/share/snips/assistant/**	r,

		/						mr,
		@{DOCKER_OVERLAY}/				r,
		@{DOCKER_OVERLAY2}/				r,
		/tmp/**						mlkrw,
		@{DOCKER_OVERLAY}/tmp/**			mlkrw,
		@{DOCKER_OVERLAY2}/tmp/**			mlkrw,
		/tmp/						mr,
		@{DOCKER_OVERLAY}/tmp/				mr,
		@{DOCKER_OVERLAY2}/tmp/				mr,

		/usr/bin/python3*				rix,
		@{DOCKER_OVERLAY}/usr/bin/python3*		rix,
		@{DOCKER_OVERLAY2}/usr/bin/python3*		rix,

		# Rules for running python scripts
		/usr/lib{,32,64}/python3{,.[0-7]}/		mr,
		@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3{,.[0-7]}/	mr,
		@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3{,.[0-7]}/	mr,
		/usr/lib{,32,64}/python3{,.[0-7]}/**			mr,
		@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3{,.[0-7]}/**	mr,
		@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3{,.[0-7]}/**	mr,
		/usr/lib{,32,64}/python3{,.[0-7]}/**/			mr,
		@{DOCKER_OVERLAY}/usr/lib{,32,64}/python3{,.[0-7]}/**/	mr,
		@{DOCKER_OVERLAY2}/usr/lib{,32,64}/python3{,.[0-7]}/**/	mr,

		/usr/local/lib{,32,64}/python3{,.[0-7]}/		mr,
		@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/	mr,
		@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/	mr,
		/usr/local/lib{,32,64}/python3{,.[0-7]}/**/		mr,
		@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/**/	mr,
		@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/**/	mr,
		/usr/local/lib{,32,64}/python3{,.[0-7]}/**		mr,
		@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python3{,.[0-7]}/**	mr,
		@{DOCKER_OVERLAY2}/usr/local/lib{,32,64}/python3{,.[0-7]}/**	mr,

		/etc/python3.[0-7]/**				r,
		@{DOCKER_OVERLAY}/etc/python3.[0-7]/**		r,
		@{DOCKER_OVERLAY2}/etc/python3.[0-7]/**		r,

		/usr/share/{pyshared,pycentral,python-support}/**	r,
		@{DOCKER_OVERLAY}/usr/share/{pyshared,pycentral,python-support}/**	r,
		@{DOCKER_OVERLAY2}/usr/share/{pyshared,pycentral,python-support}/**	r,
		/{var,usr}/lib/{pyshared,pycentral,python-support}/**	r,
		@{DOCKER_OVERLAY}/{var,usr}/lib/{pyshared,pycentral,python-support}/**	r,
		@{DOCKER_OVERLAY2}/{var,usr}/lib/{pyshared,pycentral,python-support}/**	r,
		/usr/lib/{pyshared,pycentral,python-support}/**.so	mr,
		@{DOCKER_OVERLAY}/usr/lib/{pyshared,pycentral,python-support}/**.so	mr,
		@{DOCKER_OVERLAY2}/usr/lib/{pyshared,pycentral,python-support}/**.so	mr,
		/var/lib/{pyshared,pycentral,python-support}/**.pyc	mr,
		@{DOCKER_OVERLAY}/var/lib/{pyshared,pycentral,python-support}/**.pyc	mr,
		@{DOCKER_OVERLAY2}/var/lib/{pyshared,pycentral,python-support}/**.pyc	mr,

		/usr/lib/wx/python/*.pth				r,
		#@{DOCKER_OVERLAY}/usr/lib/wx/python/*.pth		r,
		# Rules for installing pip packages
		#/usr/include/python3.[0-7]*/pyconfig.h			r,
		#@{DOCKER_OVERLAY}/usr/include/python3.[0-7]*/pyconfig.h	r,

		#/usr/share/python-wheels/				r,
		#@{DOCKER_OVERLAY}/usr/share/python-wheels/		r,
		#/usr/share/python-wheels/**				r,
		#@{DOCKER_OVERLAY}/usr/share/python-wheels/**		r,

		#/usr/local/lib{,32,64}/python{2.7,3.[0-7]}/{dist,site}-packages/**	mrw,
		#@{DOCKER_OVERLAY}/usr/local/lib{,32,64}/python{2.7,3.[0-7]}/{dist,site}-packages/**	mrw,

		#/usr/lib/{,x86_64-linux-gnu/}pkgconfig/		mr,
		#@{DOCKER_OVERLAY}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/	mr,
		#/usr/lib/{,x86_64-linux-gnu/}pkgconfig/**		mr,
		#@{DOCKER_OVERLAY}/usr/lib/{,x86_64-linux-gnu/}pkgconfig/**	mr,
	}

	profile /usr/sbin/mosquitto flags=(attach_disconnected,mediate_deleted) {
		#include <abstractions/base>
		#include <abstractions/nameservice>
		#include <abstractions/openssl>
		#include <abstractions/ssl_certs>

		/data/mosquitto.db					mlkrw,
		/data/mosquitto.db.new					mlkrw,
		/etc/mosquitto/mosquitto.conf				r,
		/etc/mosquitto/conf.d/					r,
		@{DOCKER_OVERLAY}/etc/mosquitto/conf.d/			r,
		@{DOCKER_OVERLAY2}/etc/mosquitto/conf.d/		r,
		/etc/mosquitto/conf.d/*					r,
		@{DOCKER_OVERLAY}/etc/mosquitto/conf.d/*		r,
		@{DOCKER_OVERLAY2}/etc/mosquitto/conf.d/*		r,
		/share/**						r,
		/var/lib/mosquitto/					r,
		/var/lib/mosquitto/mosquitto.db				rwk,
		/var/run/mosquitto.pid					rw,
		/usr/sbin/mosquitto					mr,

		network inet stream,
		network inet6 stream,
		network inet dgram,
		network inet6 dgram,

		capability net_bind_service,
		capability setgid,
		capability setuid,

		# Support TCP Wrappers
		/lib{,32,64}/libwrap.so*				mr,
		/etc/hosts.allow					r,
		/etc/hosts.deny						r,
	}
}
